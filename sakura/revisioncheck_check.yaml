---
- name: Check revision data are set
  assert:
    that:
      - revisioncheck_this.timestamp
      - revisioncheck_this.id

- name: Ensure state file exists
  copy:
    content: ""
    dest: "{{ revisioncheck_yaml }}"
    # copy does not touch DEST when force: no
    force: no

- name: Load previous machine_setups_revision
  slurp:
    src: "{{ revisioncheck_yaml }}"
  register: _revisioncheck_previous_slurped

- name: Set facts of machine_setups_revision
  set_fact:
    _revisioncheck_previous: "{{ _revisioncheck_previous_slurped.content | b64decode | from_yaml }}"

- name: Check revision timestamp
  assert:
    that:
      # Somehow previsou_revision.timestamp is stored as a string
      - _revisioncheck_previous.timestamp|default(0)|int <= revisioncheck_this.timestamp|int
