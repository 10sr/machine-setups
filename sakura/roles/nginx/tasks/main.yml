---
- apt:
    name: nginx
    state: present
  become: yes

- file:
    dest: "{{ nginx_main_root }}"
    state: directory
    recurse: yes
  become: yes

- copy:
    src: index.html
    dest: "{{ nginx_main_root }}/index.html"
  become: yes

- template:
    src: main.conf.j2
    dest: /etc/nginx/conf.d/main.conf
  become: yes
  register: _main_conf

- service:
    name: nginx
    state: restarted
  become: yes
  when: _main_conf | changed

- service:
    name: nginx
    enabled: yes
    state: started
  become: yes
