server {
    listen 443 ssl http2;

    server_name {{ nginx_ssl_main_server_name }};
    root {{ nginx_ssl_main_root }};

{% for upstream in nginx_ssl_proxy_upstreams | default([]) %}

    location {{ upstream.path }}/ {
{% for directive in upstream.additional_directives | default([]) %}
        {{ directive }};
{% endfor %}
        proxy_pass http://127.0.0.1:{{ upstream.port }};

    }

{% endfor %}
}
